<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>TILT Dev UI</title>
</head>
<body>
  <h2>TILT ‚Äì Dev UI</h2>

  <input id="topicInput" placeholder="Enter topic" />
  <button onclick="createTopic()">Create</button>

  <hr />

  <button onclick="loadTopics()">Load Topics</button>
  <ul id="topics"></ul>

  <script>
    const API = "http://localhost:3000"

    async function createTopic() {
      const topic = document.getElementById("topicInput").value
      await fetch(`${API}/topics`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ topic })
      })
      loadTopics()
    }

    async function loadTopics() {
      const res = await fetch(`${API}/topics`, {
        credentials: "include"
      })
      const data = await res.json()

      const list = document.getElementById("topics")
      list.innerHTML = ""

      data.forEach(t => {
        const li = document.createElement("li")
        li.innerHTML = `
          <b>${t.topic}</b>
          üëç ${t.upCount} üëé ${t.downCount}
          <button onclick="vote(${t.id}, 'up')">Up</button>
          <button onclick="vote(${t.id}, 'down')">Down</button>
          <button onclick="del(${t.id})">Delete</button>
        `
        list.appendChild(li)
      })
    }

    async function vote(id, value) {
      await fetch(`${API}/topics/${id}/vote`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ value })
      })
      loadTopics()
    }

    async function del(id) {
      await fetch(`${API}/topics/${id}`, {
        method: "DELETE",
        credentials: "include"
      })
      loadTopics()
    }
  </script>
</body>
</html>
